---
title: Astro Recognizer
layout: page
---

<p><a href="{{ site.baseurl }}/">Home</a> | <a href="{{ site.baseurl }}/astro_recognizer">Classifier</a></p>

<input id="image-input" type="file">
<div id="image-preview"></div>
<div id="loading" style="display: none;">Analyzing...</div>
<div id="result"></div>

<!-- Back to Home Button -->
<div style="margin-top: 20px;">
  <a href="{{ site.baseurl }}/" style="
    display: inline-block;
    padding: 10px 20px;
    background-color: #0366d6;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.2s;
  ">
    ‚Üê Back to Home
  </a>
</div>

<!-- <script type="module">
  // Import the Gradio client
  import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

  // Get references to HTML elements
  const imageInput = document.getElementById("image-input");
  const imagePreview = document.getElementById("image-preview");
  const resultDiv = document.getElementById("result");
  const loadingDiv = document.getElementById("loading");

  // Handle file input change
  imageInput.addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (file) {
      // Display the uploaded image
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.src = e.target.result;
        imagePreview.style.display = "block";
      };
      reader.readAsDataURL(file);

      // Show loading indicator
      loadingDiv.style.display = "block";
      resultDiv.textContent = "";

      try {
        // Connect to the Gradio app
        console.log("Connecting to Gradio app...");
        const client = await Client.connect("nosttradamus/astro-recognizer");
        console.log("Connected to Gradio app!");

        // Convert the file to a blob
        const imageBlob = new Blob([file], { type: file.type });
        console.log("Image converted to blob:", imageBlob);

        // Make the prediction
        console.log("Making prediction...");
        const result = await client.predict("/predict", {
          image: imageBlob,
        });
        console.log("Prediction result:", result);

        // Display the result
        resultDiv.textContent = `Prediction: ${JSON.stringify(result.data)}`;
      } catch (error) {
        console.error("Error calling the API:", error);
        resultDiv.textContent = "An error occurred. Please try again.";
      } finally {
        // Hide loading indicator
        loadingDiv.style.display = "none";
      }
    }
  });
</script> -->

<script type="module">
  import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

  const imageInput = document.getElementById("image-input");
  const imagePreview = document.getElementById("image-preview");
  const resultDiv = document.getElementById("result");
  const loadingDiv = document.getElementById("loading");

  imageInput.addEventListener("change", async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    // Reset UI
    imagePreview.innerHTML = '';
    resultDiv.textContent = '';
    loadingDiv.style.display = "block";

    try {
      // Display preview
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.innerHTML = `<img src="${e.target.result}" style="max-width: 300px; margin: 15px 0; border-radius: 6px;">`;
      };
      reader.readAsDataURL(file);

      // API Call
      const client = await Client.connect("nosttradamus/astro-recognizer");
      const result = await client.predict("/predict", {
        image: new Blob([file], { type: file.type })
      });

      console.log("RAW API RESPONSE:", result);

      // Adaptive response handling
      let predictions;
      
      // Try different response structures
      if (Array.isArray(result?.data?.[0]?.[0])) {
        // Original array format
        predictions = result.data[0][0];
      } else if (Array.isArray(result?.data?.[0]?.data)) {
        // Object-with-data format
        predictions = result.data[0].data;
      } else if (Array.isArray(result?.data)) {
        // Direct predictions array
        predictions = result.data;
      } else {
        // Final fallback attempt
        const flatData = Object.values(result.data).flat(Infinity);
        predictions = flatData.find(Array.isArray);
      }

      if (!Array.isArray(predictions)) {
        console.error("Unsupported response format:", result?.data);
        throw new Error("API returned unexpected format");
      }

      // Process predictions
      const validPredictions = predictions
        .filter(p => p?.tibel?.trim() && typeof p?.confidence === 'number')
        .sort((a, b) => b.confidence - a.confidence);

      if (validPredictions.length === 0) {
        throw new Error("No valid predictions found");
      }

      // Format output
      const cleanLabel = validPredictions[0].tibel
        .replace(/([a-z])([A-Z])/g, '$1 $2')
        .replace(/\b\w/g, c => c.toUpperCase());

      resultDiv.innerHTML = `
        <div class="prediction-result">
          <span class="emoji">üî≠</span>
          <strong>Prediction:</strong> 
          <span class="label">${cleanLabel}</span>
        </div>
      `;

    } catch (error) {
      console.error("Error Context:", {
        error,
        response: result?.data,
        predictions
      });
      
      resultDiv.innerHTML = `
        <div class="error-message">
          <span class="emoji">‚ö†Ô∏è</span>
          ${error.message.includes('unexpected format') 
            ? 'API format changed - contact support'
            : error.message}
        </div>
      `;

    } finally {
      loadingDiv.style.display = "none";
    }
  });

  // Add basic CSS styling
  const style = document.createElement('style');
  style.textContent = `
    .prediction-result {
      padding: 15px;
      margin: 20px 0;
      background: #f8f9fa;
      border: 1px solid #e1e4e8;
      border-radius: 8px;
      font-size: 18px;
    }
    .error-message {
      padding: 15px;
      margin: 20px 0;
      background: #fff5f5;
      border: 1px solid #ffd6d6;
      border-radius: 8px;
      color: #cf222e;
    }
    .emoji {
      margin-right: 10px;
    }
    .label {
      color: #0969da;
      font-weight: 600;
    }
  `;
  document.head.appendChild(style);
</script>